!function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="/",t(0)}([function(e,t,i){"use strict";function n(){function e(e){i.hide(),r.scaling=e.scaling,r.highResolution=e.highResolution,r.once("quit",t),r.show(),r.start({width:e.width,height:e.height,gameMode:e.gameMode,colorScheme:e.colorScheme})}function t(){r.hide(),i.once("play",e),i.show()}window.removeEventListener("load",n);var i=new o.TitleManager,r=new s.GameManager;i.once("play",e),i.show()}var o=i(8),s=i(6);window.addEventListener("load",n)},function(e,t,i){var n,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(s){function r(){this._events={},this._conf&&l.call(this,this._conf)}function l(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function a(e){this._events={},this.newListener=!1,l.call(this,e)}function h(e,t,i,n){if(!i)return[];var o,s,r,l,a,c,_,u=[],d=t.length,f=t[n],p=t[n+1];if(n===d&&i._listeners){if("function"==typeof i._listeners)return e&&e.push(i._listeners),[i];for(o=0,s=i._listeners.length;o<s;o++)e&&e.push(i._listeners[o]);return[i]}if("*"===f||"**"===f||i[f]){if("*"===f){for(r in i)"_listeners"!==r&&i.hasOwnProperty(r)&&(u=u.concat(h(e,t,i[r],n+1)));return u}if("**"===f){_=n+1===d||n+2===d&&"*"===p,_&&i._listeners&&(u=u.concat(h(e,t,i,d)));for(r in i)"_listeners"!==r&&i.hasOwnProperty(r)&&("*"===r||"**"===r?(i[r]._listeners&&!_&&(u=u.concat(h(e,t,i[r],d))),u=u.concat(h(e,t,i[r],n))):u=r===p?u.concat(h(e,t,i[r],n+2)):u.concat(h(e,t,i[r],n)));return u}u=u.concat(h(e,t,i[f],n+1))}if(l=i["*"],l&&h(e,t,l,n+1),a=i["**"])if(n<d){a._listeners&&h(e,t,a,d);for(r in a)"_listeners"!==r&&a.hasOwnProperty(r)&&(r===p?h(e,t,a[r],n+2):r===f?h(e,t,a[r],n+1):(c={},c[r]=a[r],h(e,t,{"**":c},n+1)))}else a._listeners?h(e,t,a,d):a["*"]&&a["*"]._listeners&&h(e,t,a["*"],d);return u}function c(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var i=0,n=e.length;i+1<n;i++)if("**"===e[i]&&"**"===e[i+1])return;for(var o=this.listenerTree,s=e.shift();s;){if(o[s]||(o[s]={}),o=o[s],0===e.length){if(o._listeners){if("function"==typeof o._listeners)o._listeners=[o._listeners,t];else if(_(o._listeners)&&(o._listeners.push(t),!o._listeners.warned)){var r=u;"undefined"!=typeof this._events.maxListeners&&(r=this._events.maxListeners),r>0&&o._listeners.length>r&&(o._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",o._listeners.length),console.trace&&console.trace())}}else o._listeners=t;return!0}s=e.shift()}return!0}var _=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},u=10;a.EventEmitter2=a,a.prototype.delimiter=".",a.prototype.setMaxListeners=function(e){this._events||r.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},a.prototype.event="",a.prototype.once=function(e,t){return this.many(e,1,t),this},a.prototype.many=function(e,t,i){function n(){0===--t&&o.off(e,n),i.apply(this,arguments)}var o=this;if("function"!=typeof i)throw new Error("many only accepts instances of Function");return n._origin=i,this.on(e,n),o},a.prototype.emit=function(){this._events||r.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;var t,i,n,o,s,l=arguments.length;if(this._all&&this._all.length){if(s=this._all.slice(),l>3)for(t=new Array(l),o=0;o<l;o++)t[o]=arguments[o];for(n=0,i=s.length;n<i;n++)switch(this.event=e,l){case 1:s[n].call(this,e);break;case 2:s[n].call(this,e,arguments[1]);break;case 3:s[n].call(this,e,arguments[1],arguments[2]);break;default:s[n].apply(this,t)}}if(this.wildcard){s=[];var a="string"==typeof e?e.split(this.delimiter):e.slice();h.call(this,s,a,this.listenerTree,0)}else{if(s=this._events[e],"function"==typeof s){switch(this.event=e,l){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(l-1),o=1;o<l;o++)t[o-1]=arguments[o];s.apply(this,t)}return!0}s&&(s=s.slice())}if(s&&s.length){if(l>3)for(t=new Array(l-1),o=1;o<l;o++)t[o-1]=arguments[o];for(n=0,i=s.length;n<i;n++)switch(this.event=e,l){case 1:s[n].call(this);break;case 2:s[n].call(this,arguments[1]);break;case 3:s[n].call(this,arguments[1],arguments[2]);break;default:s[n].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},a.prototype.emitAsync=function(){this._events||r.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,i,n,o,s,l=[],a=arguments.length;if(this._all){if(a>3)for(t=new Array(a),o=1;o<a;o++)t[o]=arguments[o];for(n=0,i=this._all.length;n<i;n++)switch(this.event=e,a){case 1:l.push(this._all[n].call(this,e));break;case 2:l.push(this._all[n].call(this,e,arguments[1]));break;case 3:l.push(this._all[n].call(this,e,arguments[1],arguments[2]));break;default:l.push(this._all[n].apply(this,t))}}if(this.wildcard){s=[];var c="string"==typeof e?e.split(this.delimiter):e.slice();h.call(this,s,c,this.listenerTree,0)}else s=this._events[e];if("function"==typeof s)switch(this.event=e,a){case 1:l.push(s.call(this));break;case 2:l.push(s.call(this,arguments[1]));break;case 3:l.push(s.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(a-1),o=1;o<a;o++)t[o-1]=arguments[o];l.push(s.apply(this,t))}else if(s&&s.length){if(a>3)for(t=new Array(a-1),o=1;o<a;o++)t[o-1]=arguments[o];for(n=0,i=s.length;n<i;n++)switch(this.event=e,a){case 1:l.push(s[n].call(this));break;case 2:l.push(s[n].call(this,arguments[1]));break;case 3:l.push(s[n].call(this,arguments[1],arguments[2]));break;default:l.push(s[n].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(l)},a.prototype.on=function(e,t){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");if(this._events||r.call(this),this.emit("newListener",e,t),this.wildcard)return c.call(this,e,t),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],t];else if(_(this._events[e])&&(this._events[e].push(t),!this._events[e].warned)){var i=u;"undefined"!=typeof this._events.maxListeners&&(i=this._events.maxListeners),i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace&&console.trace())}}else this._events[e]=t;return this},a.prototype.onAny=function(e){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},a.prototype.addListener=a.prototype.on,a.prototype.off=function(e,t){function i(e){if(e!==s){var t=Object.keys(e);for(var n in t){var r=t[n],l=e[r];l instanceof Function||"object"!==("undefined"==typeof l?"undefined":o(l))||(Object.keys(l).length>0&&i(e[r]),0===Object.keys(l).length&&delete e[r])}}}if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var l="string"==typeof e?e.split(this.delimiter):e.slice();r=h.call(this,null,l,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n})}for(var a=0;a<r.length;a++){var c=r[a];if(n=c._listeners,_(n)){for(var u=-1,d=0,f=n.length;d<f;d++)if(n[d]===t||n[d].listener&&n[d].listener===t||n[d]._origin&&n[d]._origin===t){u=d;break}if(u<0)continue;return this.wildcard?c._listeners.splice(u,1):this._events[e].splice(u,1),0===n.length&&(this.wildcard?delete c._listeners:delete this._events[e]),this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete c._listeners:delete this._events[e],this.emit("removeListener",e,t))}return i(this.listenerTree),this},a.prototype.offAny=function(e){var t,i=0,n=0;if(e&&this._all&&this._all.length>0){for(t=this._all,i=0,n=t.length;i<n;i++)if(e===t[i])return t.splice(i,1),this.emit("removeListenerAny",e),this}else{for(t=this._all,i=0,n=t.length;i<n;i++)this.emit("removeListenerAny",t[i]);this._all=[]}return this},a.prototype.removeListener=a.prototype.off,a.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||r.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),i=h.call(this,null,t,this.listenerTree,0),n=0;n<i.length;n++){var o=i[n];o._listeners=null}else{if(!this._events||!this._events[e])return this;this._events[e]=null}return this},a.prototype.listeners=function(e){if(this.wildcard){var t=[],i="string"==typeof e?e.split(this.delimiter):e.slice();return h.call(this,t,i,this.listenerTree,0),t}return this._events||r.call(this),this._events[e]||(this._events[e]=[]),_(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},a.prototype.listenersAny=function(){return this._all?this._all:[]},n=function(){return a}.call(t,i,t,e),!(n!==s&&(e.exports=n))}()},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();t.Point=function(){function e(t,n){i(this,e),this.x=t,this.y=n}return n(e,null,[{key:"add",value:function(t,i){return new e(t.x+i.x,t.y+i.y)}},{key:"equal",value:function(e,t){return e.x===t.x&&e.y===t.y}}]),e}(),t.Rectangle=function o(e,t,n,s){i(this,o),this.x=e,this.y=t,this.width=n,this.height=s},t.Color=function(){function e(t,n,o,s){i(this,e),this.r=t,this.g=n,this.b=o,this.a=s}return n(e,[{key:"toInt",value:function(){return this.a<<24|this.r<<16|this.g<<8|this.b}},{key:"toCSSColor",value:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a/255+")"}}],[{key:"fromInt",value:function(t){return new e(t>>>16&255,t>>>8&255,255&t,t>>>24&255)}}]),e}()},function(e,t){"use strict";function i(){if(r){var e=window.document.body.requestFullscreen||window.document.body.mozRequestFullScreen||window.document.body.webkitRequestFullscreen;"function"==typeof e&&e.call(window.document.body)}}function n(){if(r){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;return!!e}return!1}function o(){if(r){var e=window.document.exitFullscreen||window.document.mozCancelFullScreen||window.document.webkitExitFullscreen;"function"==typeof e&&e.call(window.document)}}function s(){r&&(n()?o():i())}Object.defineProperty(t,"__esModule",{value:!0}),t.requestFullscreen=i,t.isFullscreen=n,t.exitFullscreen=o,t.toggleFullscreen=s;var r=t.FULL_SCREEN_ENABLED=!!(window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.webkitFullscreenEnabled)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Bitmap=void 0;var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(2);t.Bitmap=function(){function e(t){n(this,e),this.canvas=t,this._ctx=t.getContext("2d")}return o(e,[{key:"getPixel",value:function(e){var t=this._ctx.getImageData(e.x,e.y,1,1);return new s.Color(t.data[0],t.data[1],t.data[2],t.data[3])}},{key:"getAlpha",value:function(e){var t=this._ctx.getImageData(e.x,e.y,1,1);return t.data[3]}},{key:"setPixel",value:function(e,t){var i=this._ctx.createImageData(1,1);i.data[0]=t.r,i.data[1]=t.g,i.data[2]=t.b,i.data[3]=t.a,this._ctx.putImageData(i,e.x,e.y)}},{key:"fillRect",value:function(e,t){this._ctx.save(),this._ctx.globalCompositeOperation="copy",this._ctx.imageSmoothingEnabled=!1,this._ctx.beginPath(),this._ctx.rect(e.x,e.y,e.width,e.height),this._ctx.clip(),this._ctx.fillStyle=t.toCSSColor(),this._ctx.fill(),this._ctx.restore(),this._ctx.beginPath()}},{key:"copyPixels",value:function(e,t,i){this._ctx.save(),this._ctx.globalCompositeOperation="copy",this._ctx.imageSmoothingEnabled=!1,this._ctx.beginPath(),this._ctx.rect(i.x,i.y,t.width,t.height),this._ctx.clip(),this._ctx.drawImage(e.canvas,t.x,t.y,t.width,t.height,i.x,i.y,t.width,t.height),this._ctx.restore(),this._ctx.beginPath()}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Clock=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(1),a=16;t.Clock=function(e){function t(e){n(this,t);var i=o(this,Object.getPrototypeOf(t).call(this));return i._frequency=e,i._total=0,i._oldTime=void 0,i._intervalId=void 0,i._onTick=function(){var e=Date.now(),t=e-i._oldTime;for(i._oldTime=e,i._total+=t/1e3;i._total>=1/i._frequency;)i._total-=1/i._frequency,i.emit("clock",e)},i}return s(t,e),r(t,[{key:"start",value:function(){this._oldTime=Date.now(),this._intervalId=window.setInterval(this._onTick,a)}},{key:"reset",value:function(){this._oldTime=Date.now(),this._total=0}},{key:"stop",value:function(){window.clearInterval(this._intervalId)}},{key:"frequency",get:function(){return this._frequency},set:function(e){this._frequency=e,this.reset()}}]),t}(l.EventEmitter2)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(e){var t={};for(var i in e)t[i]=d.Color.fromInt(e[i]);return t}function a(e){switch(e){case 0:case 1:case 2:return"Game paused";case 3:return"Game paused?";default:return k[Math.floor(Math.random()*k.length)]}}Object.defineProperty(t,"__esModule",{value:!0}),t.GameManager=void 0;var h,c,_=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=i(1),d=i(2),f=i(7),p=i(3),y=1,v=Object.freeze({standard:l((h={background:4278190080},r(h,f.BlockColorPrefix.BLOCK+f.BlockType.I,4282449919),r(h,f.BlockColorPrefix.BLOCK+f.BlockType.O,4293980192),r(h,f.BlockColorPrefix.BLOCK+f.BlockType.S,4282445888),r(h,f.BlockColorPrefix.BLOCK+f.BlockType.Z,4294942880),r(h,f.BlockColorPrefix.BLOCK+f.BlockType.J,4286611711),r(h,f.BlockColorPrefix.BLOCK+f.BlockType.L,4294950912),r(h,f.BlockColorPrefix.BLOCK+f.BlockType.T,4290797823),r(h,f.BlockColorPrefix.GHOST+f.BlockType.I,2151743487),r(h,f.BlockColorPrefix.GHOST+f.BlockType.O,2163273760),r(h,f.BlockColorPrefix.GHOST+f.BlockType.S,2151739456),r(h,f.BlockColorPrefix.GHOST+f.BlockType.Z,2164236448),r(h,f.BlockColorPrefix.GHOST+f.BlockType.J,2155905279),r(h,f.BlockColorPrefix.GHOST+f.BlockType.L,2164244480),r(h,f.BlockColorPrefix.GHOST+f.BlockType.T,2160091391),h)),grayscale:l((c={background:4282400832},r(c,f.BlockColorPrefix.BLOCK+f.BlockType.I,4293980400),r(c,f.BlockColorPrefix.BLOCK+f.BlockType.O,4293980400),r(c,f.BlockColorPrefix.BLOCK+f.BlockType.S,4293980400),r(c,f.BlockColorPrefix.BLOCK+f.BlockType.Z,4293980400),r(c,f.BlockColorPrefix.BLOCK+f.BlockType.J,4293980400),r(c,f.BlockColorPrefix.BLOCK+f.BlockType.L,4293980400),r(c,f.BlockColorPrefix.BLOCK+f.BlockType.T,4293980400),r(c,f.BlockColorPrefix.GHOST+f.BlockType.I,4286611584),r(c,f.BlockColorPrefix.GHOST+f.BlockType.O,4286611584),r(c,f.BlockColorPrefix.GHOST+f.BlockType.S,4286611584),r(c,f.BlockColorPrefix.GHOST+f.BlockType.Z,4286611584),r(c,f.BlockColorPrefix.GHOST+f.BlockType.J,4286611584),r(c,f.BlockColorPrefix.GHOST+f.BlockType.L,4286611584),r(c,f.BlockColorPrefix.GHOST+f.BlockType.T,4286611584),c))}),w=Object.freeze({MOVE_LEFT:37,MOVE_RIGHT:39,SOFT_DROP:40,HARD_DROP:38,ROTATE_CLOCKWISE:90,ROTATE_COUNTERCLOCKWISE:88,HOLD:67,PAUSE:80,QUIT:81,TOGGLE_VIEW:86,TOGGLE_FULLSCREEN:70}),m=5,g=8,k=["Game paused","Hello","Go ahead","Try again","Away from keyboard","Wait a minute","You reached the limit","Gimme your voice","Eat avocados","Complex scalar field","Many a little makes a mickle","Stop right now","Looks glitched to me"];t.GameManager=function(e){function t(){n(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e._wrapper=window.document.getElementById("game-wrapper"),e._leftView=window.document.getElementById("game-left-view"),e._holdWrapper=window.document.getElementById("game-hold"),e._rightView=window.document.getElementById("game-right-view"),e._nextWrapper=window.document.getElementById("game-next"),e._linesText=window.document.getElementById("game-lines"),e._scoreText=window.document.getElementById("game-score"),e._levelText=window.document.getElementById("game-level"),e._messageText=window.document.getElementById("game-message"),e._pausedScreen=window.document.getElementById("game-paused-screen"),e._pausedText=window.document.getElementById("game-paused-text"),e._overScreen=window.document.getElementById("game-over-screen"),e._overResultText=window.document.getElementById("game-over-result"),e._overShare=window.document.getElementById("game-over-share"),e._overBackButton=window.document.getElementById("game-over-back-button"),e._visible=!1,e._paused=!1,e._over=!0,e._updateVisibility(),e._enabled=!1,e._scaling=!1,e._highResolution=!1,e._center(),e._rescale(!0),window.addEventListener("resize",function(){e._center(),e._rescale(!1)}),e._viewOpacityLevel=2,e._updateViewOpacity(),e._width=0,e._height=0,e._game=null,e._onGameScoreUpdate=function(t){e._linesText.innerText="Lines: "+t.lines,e._scoreText.innerText="Score: "+t.score,e._levelText.innerText="Level: "+t.level},e._onGameMessage=function(t){e._messageText.innerText=t},e._onGameOver=function(){e._over=!0;var t="Size: "+e._width+" x "+e._height+", "+("Lines: "+e._game.lines+", ")+("Score: "+e._game.score+", ")+("Level: "+e._game.level),i=t+(e._game.gameMode!==f.GameMode.STANDARD?" ("+e._game.gameMode+")":"")+" - dotris";e._overResultText.innerText=t,e._updateShareButtons(i),e._updateVisibility(),e._overScreen.style.opacity="1"},e._onKeyDown=function(t){e._enabled&&(t.preventDefault(),e._keyboardControl(t.keyCode))},e._overBackButton.addEventListener("click",function(){e._enabled&&e._over&&e.quit()}),e._pauseCounter=0,e}return s(t,e),_(t,[{key:"_center",value:function(){this._wrapper.style.top=.5*(window.innerHeight-(this._height+2*y))+"px",this._wrapper.style.left=.5*(window.innerWidth-(this._width+2*y))+"px"}},{key:"_rescale",value:function(e){if(this._scaling){var t=this._width/this._height>=window.innerWidth/window.innerHeight?window.innerWidth/this._width:window.innerHeight/this._height;t<=0||Number.isNaN(t)||!Number.isFinite(t)?this._wrapper.style.transform="none":this._wrapper.style.transform="scale("+t+","+t+")"}else if(e)if(this._highResolution){var i=1/(window.devicePixelRatio||1);this._wrapper.style.transform="scale("+i+","+i+")"}else this._wrapper.style.transform="none"}},{key:"_updateVisibility",value:function(){this._visible?this._over?(this._wrapper.style.display="block",this._leftView.style.display="block",this._rightView.style.display="block",this._pausedScreen.style.display="none",this._overScreen.style.display="block"):this._paused?(this._wrapper.style.display="none",this._leftView.style.display="none",this._rightView.style.display="none",this._pausedScreen.style.display="block",this._overScreen.style.display="none"):(this._wrapper.style.display="block",this._leftView.style.display="block",this._rightView.style.display="block",this._pausedScreen.style.display="none",this._overScreen.style.display="none"):(this._wrapper.style.display="none",this._leftView.style.display="none",this._rightView.style.display="none",this._pausedScreen.style.display="none",this._overScreen.style.display="none")}},{key:"_updateViewOpacity",value:function(){this._leftView.style.opacity=""+.5*this._viewOpacityLevel,this._rightView.style.opacity=""+.5*this._viewOpacityLevel,this._overScreen.style.opacity=""+.5*this._viewOpacityLevel}},{key:"_updateShareButtons",value:function(e){for(;this._overShare.firstChild;)this._overShare.removeChild(this._overShare.firstChild);window.twttr.widgets.createShareButton("",this._overShare,{text:e})}},{key:"show",value:function(){this._visible=!0,this._updateVisibility(),this._enabled=!0}},{key:"hide",value:function(){this._enabled=!1,this._visible=!1,this._updateVisibility()}},{key:"start",value:function(e){if(!this._game){this._width=e.width,this._height=e.height;var t=v[e.colorScheme]||v.standard;this._wrapper.style.width=this._width+"px",this._wrapper.style.height=this._height+"px",this._wrapper.style.backgroundColor=t.background.toCSSColor(),this._center(),this._rescale(!1),this._game=new f.Game({innerWidth:this._width,innerHeight:this._height,gameMode:e.gameMode,colors:t,numNextBlocks:m}),this._game.canvas.className="game-canvas",this._game.canvas.style.top=-this._game.topOffset+"px",this._game.canvas.style.left=-this._game.leftOffset+"px",this._wrapper.appendChild(this._game.canvas),this._game.nextCanvas.style.width=this._game.nextCanvas.width*g+"px",this._game.nextCanvas.style.height=this._game.nextCanvas.height*g+"px",this._game.nextCanvas.style.backgroundColor=t.background.toCSSColor(),this._nextWrapper.appendChild(this._game.nextCanvas),this._game.holdCanvas.style.width=this._game.holdCanvas.width*g+"px",this._game.holdCanvas.style.height=this._game.holdCanvas.height*g+"px",this._game.holdCanvas.style.backgroundColor=t.background.toCSSColor(),this._holdWrapper.appendChild(this._game.holdCanvas),this._linesText.innerText="Lines: "+this._game.lines,this._scoreText.innerText="Score: "+this._game.score,this._levelText.innerText="Level: "+this._game.level,this._messageText.innerText="",this._paused=!1,this._over=!1,this._updateVisibility(),this._pauseCounter=0,this._pausedText.innerText=a(this._pauseCounter),this._game.on("scoreUpdate",this._onGameScoreUpdate),this._game.on("message",this._onGameMessage),this._game.on("over",this._onGameOver),window.addEventListener("keydown",this._onKeyDown),this._game.start()}}},{key:"pause",value:function(){this._game&&!this._over&&(this._game.pause(),this._paused=!this._paused,this._paused&&(this._pauseCounter++,this._pausedText.innerText=a(this._pauseCounter)),this._updateVisibility())}},{key:"quit",value:function(){this._game&&(this._game.off("scoreUpdate",this._onGameScoreUpdate),this._game.off("message",this._onGameMessage),this._game.off("over",this._onGameOver),window.removeEventListener("keydown",this._onKeyDown),this._game.quit(),this._paused=!1,this._over=!0,this._wrapper.removeChild(this._game.canvas),this._nextWrapper.removeChild(this._game.nextCanvas),this._holdWrapper.removeChild(this._game.holdCanvas),this._game=null,this.emit("quit"))}},{key:"_keyboardControl",value:function(e){if(this._game)switch(e){case w.MOVE_LEFT:this._game.moveLeft();break;case w.MOVE_RIGHT:this._game.moveRight();break;case w.SOFT_DROP:this._game.softDrop();break;case w.HARD_DROP:this._game.hardDrop();break;case w.ROTATE_CLOCKWISE:this._game.rotateClockwise();break;case w.ROTATE_COUNTERCLOCKWISE:this._game.rotateCounterclockwise();break;case w.HOLD:this._game.hold();break;case w.PAUSE:this.pause();break;case w.QUIT:this._paused&&this.quit();break;case w.TOGGLE_VIEW:this._viewOpacityLevel=(this._viewOpacityLevel+1)%3,this._updateViewOpacity();break;case w.TOGGLE_FULLSCREEN:(0,p.toggleFullscreen)()}}},{key:"scaling",get:function(){return this._scaling},set:function(e){this._scaling=e,this._rescale(!0)}},{key:"highResolution",get:function(){return this._highResolution},set:function(e){this._highResolution=e,this._rescale(!0)}}]),t}(u.EventEmitter2)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(e,t){switch(e){case D.STANDARD:return Math.min(.6*t+F,60);case D.ENDLESS:return V;case D.AUTO:return q}}function a(e,t){switch(e){case D.STANDARD:return Math.min(.03*t+N,4);case D.ENDLESS:return V;case D.AUTO:return q}}function h(e){var t=[],i=!0,n=!1,o=void 0;try{for(var s,r=e.entries()[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var l=p(s.value,2),a=l[0],c=l[1];Array.isArray(c)?t[a]=h(c):t[a]=c}}catch(_){n=!0,o=_}finally{try{!i&&r["return"]&&r["return"]()}finally{if(n)throw o}}return t}function c(e){for(var t=e.length,i=0;i<t;i++){var n=Math.floor(Math.random()*t),o=[e[n],e[i]];e[i]=o[0],e[n]=o[1]}return e}function _(e,t){var i=e.length,n=e[0].length;if(0===i||0===n)throw new Error("invalid matrix");for(var o=[],s=0;s<n;s++)o[s]=[];if(t===A.CLOCKWISE)for(var r=0;r<n;r++)for(var l=0;l<i;l++)o[r][l]=e[i-1-l][r];else for(var a=0;a<n;a++)for(var h=0;h<i;h++)o[a][h]=e[h][i-1-a];return o}function u(e){for(var t=e[0].length,i=e.length,n=0,o=t-1,s=0,r=i-1,l=0;l<t;l++){for(var a=!1,h=0;h<i;h++)if(e[h][l]&0!==E){a=!0;break}if(a){n=l;break}}for(var c=t-1;c>=0;c--){for(var _=!1,u=0;u<i;u++)if(e[u][c]&0!==E){_=!0;break}if(_){o=c;break}}for(var d=0;d<i;d++){for(var f=!1,p=0;p<i;p++)if(e[d][p]&0!==E){f=!0;break}if(f){s=d;break}}for(var y=i-1;y>=0;y--){for(var w=!1,m=0;m<i;m++)if(e[y][m]&0!==E){w=!0;break}if(w){r=y;break}}return new v.Rectangle(n,s,o-n+1,r-s+1)}Object.defineProperty(t,"__esModule",{value:!0}),t.Game=t.GameMode=t.BlockColorPrefix=t.BlockType=void 0;var d,f=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),p=function(){function e(e,t){var i=[],n=!0,o=!1,s=void 0;try{for(var r,l=e[Symbol.iterator]();!(n=(r=l.next()).done)&&(i.push(r.value),!t||i.length!==t);n=!0);}catch(a){o=!0,s=a}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw s}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),y=i(1),v=i(2),w=i(4),m=i(5),g=1,k=6,b=4,P=new v.Color(255,255,255,255),T=new v.Color(0,0,0,0),x=t.BlockType=Object.freeze({I:"I",O:"O",S:"S",Z:"Z",J:"J",L:"L",T:"T"}),B=Object.freeze([x.I,x.O,x.S,x.Z,x.J,x.L,x.T]),O=t.BlockColorPrefix=Object.freeze({BLOCK:"block",GHOST:"ghost"}),C=0,E=1,S=2,L=4,M=function(){var e,t=C,i=E,n=S,o=L,s=S|L;return Object.freeze((e={},r(e,x.I,[[t,t,t,t],[i,i,i,i],[t,t,t,t],[t,t,t,t]]),r(e,x.O,[[i,i],[i,i]]),r(e,x.S,[[t,t,t,t,t],[t,s,i,i,n],[n,i,i,s,t],[t,t,t,t,t],[t,t,t,t,t]]),r(e,x.Z,[[t,t,t,t,t],[n,i,i,s,t],[t,s,i,i,n],[t,t,t,t,t],[t,t,t,t,t]]),r(e,x.J,[[i,s,s],[i,i,i],[n,t,n]]),r(e,x.L,[[s,s,i],[i,i,i],[n,t,n]]),r(e,x.T,[[n,i,n],[i,i,i],[n,o,n]]),e))}(),G=6,H=6,R=Object.freeze((d={},r(d,x.I,-2),r(d,x.O,-2),r(d,x.S,-3),r(d,x.Z,-3),r(d,x.J,-2),r(d,x.L,-2),r(d,x.T,-2),d)),A=Object.freeze({CLOCKWISE:0,COUNTERCLOCKWISE:1}),I=function(){var e,t=Object.freeze([[[new v.Point((-1),0),new v.Point((-1),(-1)),new v.Point(0,2),new v.Point((-1),2)],[new v.Point(1,0),new v.Point(1,(-1)),new v.Point(0,2),new v.Point(1,2)]],[[new v.Point(1,0),new v.Point(1,1),new v.Point(0,(-2)),new v.Point(1,(-2))],[new v.Point(1,0),new v.Point(1,1),new v.Point(0,(-2)),new v.Point(1,(-2))]],[[new v.Point(1,0),new v.Point(1,(-1)),new v.Point(0,2),new v.Point(1,2)],[new v.Point((-1),0),new v.Point((-1),(-1)),new v.Point(0,2),new v.Point((-1),2)]],[[new v.Point((-1),0),new v.Point((-1),1),new v.Point(0,(-2)),new v.Point((-1),(-2))],[new v.Point((-1),0),new v.Point((-1),1),new v.Point(0,(-2)),new v.Point((-1),(-2))]]]),i=Object.freeze([[[new v.Point((-2),0),new v.Point(1,0),new v.Point((-2),1),new v.Point(1,(-2))],[new v.Point((-1),0),new v.Point(2,0),new v.Point((-1),(-2)),new v.Point(2,1)]],[[new v.Point((-1),0),new v.Point(2,0),new v.Point((-1),(-2)),new v.Point(2,1)],[new v.Point(2,0),new v.Point((-1),0),new v.Point(2,(-1)),new v.Point((-1),2)]],[[new v.Point(1,0),new v.Point((-2),0),new v.Point(1,2),new v.Point((-2),(-1))],[new v.Point(2,0),new v.Point((-1),0),new v.Point(2,(-1)),new v.Point((-1),2)]],[[new v.Point(1,0),new v.Point((-2),0),new v.Point(1,2),new v.Point((-2),(-1))],[new v.Point((-2),0),new v.Point(1,0),new v.Point((-2),1),new v.Point(1,(-2))]]]),n=Object.freeze([[[new v.Point((-1),0),new v.Point((-1),(-1)),new v.Point((-1),2)],[new v.Point(1,0),new v.Point(1,(-1)),new v.Point(1,2)]],[[new v.Point(1,0),new v.Point(1,1),new v.Point(0,(-2)),new v.Point(1,(-2))],[new v.Point(1,0),new v.Point(1,1),new v.Point(0,(-2)),new v.Point(1,(-2))]],[[new v.Point(1,0),new v.Point(0,2),new v.Point(1,2)],[new v.Point((-1),0),new v.Point(0,2),new v.Point((-1),2)]],[[new v.Point((-1),0),new v.Point((-1),1),new v.Point(0,(-2)),new v.Point((-1),(-2))],[new v.Point((-1),0),new v.Point((-1),1),new v.Point(0,(-2)),new v.Point((-1),(-2))]]]);return Object.freeze((e={},r(e,x.I,i),r(e,x.O,t),r(e,x.S,t),r(e,x.Z,t),r(e,x.J,t),r(e,x.L,t),r(e,x.T,n),e))}(),W=Object.freeze({SPAWN:"spawn",MOVE:"move",ROTATE:"rotate"}),j=Object.freeze({LEFT:new v.Point((-1),0),RIGHT:new v.Point(1,0),DOWN:new v.Point(0,1)}),D=t.GameMode=Object.freeze({STANDARD:"standard",ENDLESS:"endless",AUTO:"auto"}),F=1,N=1,V=1,q=60,K=100;t.Game=function(e){function t(e){n(this,t);var i=o(this,Object.getPrototypeOf(t).call(this));return i._innerWidth=e.innerWidth,i._innerHeight=e.innerHeight,i._gameMode=e.gameMode,i._colors=e.colors,
i._numNextBlocks=e.numNextBlocks,i._fieldWidth=i._innerWidth,i._fieldHeight=i._innerHeight+k,i._width=i._fieldWidth+2*g,i._height=i._fieldHeight+2*g,i._canvas=window.document.createElement("canvas"),i._canvas.width=i._width,i._canvas.height=i._height,i._bmp=new w.Bitmap(i._canvas),i._initCanvas(),i._nextCanvas=window.document.createElement("canvas"),i._nextCanvas.width=G,i._nextCanvas.height=H*i._numNextBlocks,i._nextBmp=new w.Bitmap(i._nextCanvas),i._holdCanvas=window.document.createElement("canvas"),i._holdCanvas.width=G,i._holdCanvas.height=H,i._holdBmp=new w.Bitmap(i._holdCanvas),i._over=!1,i._lines=0,i._score=0,i._level=0,i._clock=new m.Clock(l(i._gameMode,i._level)),i._paused=!0,i._block=null,i._blockType=void 0,i._blockWidth=void 0,i._blockHeight=void 0,i._blockRotationDegree=void 0,i._blockPosition=void 0,i._ghostPosition=void 0,i._nextBlockTypes=[],i._addNextBlockTypeSequence(),i._addNextBlockTypeSequence(),i._redrawNextBlocks(),i._holdable=!0,i._holdedBlockType=void 0,i._redrawHoldedBlock(),i._lineCounter=new Array(i._fieldHeight).fill(0),i._lastMovement=void 0,i._backToBack=!1,i._spawNewBlock(),i._clock.on("clock",function(){i._over||i._paused||(i._gameMode===D.AUTO?i._hardDrop():i._clockDrop())}),i}return s(t,e),f(t,[{key:"_initCanvas",value:function(){this._bmp.fillRect(new v.Rectangle(0,0,this.width,this.height),T),this._bmp.fillRect(new v.Rectangle(0,0,this._width,1),P),this._bmp.fillRect(new v.Rectangle(0,this._height-1,this._width,1),P),this._bmp.fillRect(new v.Rectangle(0,0,1,this._height),P),this._bmp.fillRect(new v.Rectangle(this._width-1,0,1,this._height),P)}},{key:"_drawBlock",value:function(e,t){if(null!==this._block)for(var i=0;i<this._blockWidth;i++)for(var n=0;n<this._blockHeight;n++)this._block[n][i]&0!==E&&this._bmp.setPixel(v.Point.add(e,new v.Point(i,n)),t)}},{key:"_drawBlockGhost",value:function(){this._drawBlock(this._ghostPosition,this._colors[O.GHOST+this._blockType]),this._drawBlock(this._blockPosition,this._colors[O.BLOCK+this._blockType])}},{key:"_eraseBlockGhost",value:function(){this._drawBlock(this._blockPosition,T),this._drawBlock(this._ghostPosition,T)}},{key:"_redrawNextBlocks",value:function(){this._nextBmp.fillRect(new v.Rectangle(0,0,G,H*this._numNextBlocks),T);for(var e=0;e<this._numNextBlocks;e++)for(var t=this._nextBlockTypes[e],i=M[t],n=u(i),o=new v.Point(Math.floor((G-n.width)/2),Math.floor((H-n.height)/2)+H*e),s=this._colors[O.BLOCK+t],r=n.x;r<n.x+n.width;r++)for(var l=n.y;l<n.y+n.height;l++)i[l][r]&0!==E&&this._nextBmp.setPixel(v.Point.add(o,new v.Point(r-n.x,l-n.y)),s)}},{key:"_redrawHoldedBlock",value:function(){if(this._holdBmp.fillRect(new v.Rectangle(0,0,G,H),T),void 0!==this._holdedBlockType)for(var e=M[this._holdedBlockType],t=u(e),i=new v.Point(Math.floor((G-t.width)/2),Math.floor((H-t.height)/2)),n=this._colors[O.BLOCK+this._holdedBlockType],o=t.x;o<t.x+t.width;o++)for(var s=t.y;s<t.y+t.height;s++)e[s][o]&0!==E&&this._holdBmp.setPixel(v.Point.add(i,new v.Point(o-t.x,s-t.y)),n)}},{key:"_blockHitTest",value:function(){for(var e=0;e<this._blockWidth;e++)for(var t=0;t<this._blockHeight;t++)if(this._block[t][e]&0!==E){var i=this._bmp.getAlpha(v.Point.add(this._blockPosition,new v.Point(e,t)));if(i>0)return!0}return!1}},{key:"_blockSpinTest",value:function(){if(this._lastMovement===W.ROTATE){for(var e=0,t=0;t<this._blockWidth;t++)for(var i=0;i<this._blockHeight;i++)if(this._block[i][t]&0!==S){var n=this._bmp.getAlpha(v.Point.add(this._blockPosition,new v.Point(t,i)));n>0&&e++}return e>=3}return!1}},{key:"_blockSpinMiniTest",value:function(){if(this._lastMovement===W.ROTATE){for(var e=0,t=0;t<this._blockWidth;t++)for(var i=0;i<this._blockHeight;i++)if(this._block[i][t]&0!==L){var n=this._bmp.getAlpha(v.Point.add(this._blockPosition,new v.Point(t,i)));n>0&&e++}return this._blockType===x.T?1===e:e<=1}return!1}},{key:"_willLand",value:function(){for(var e=0;e<this._blockWidth;e++)for(var t=this._blockHeight-1;t>=0;t--)if(this._block[t][e]&0!==E){var i=this._bmp.getAlpha(v.Point.add(this._blockPosition,new v.Point(e,t+1)));if(i>0)return!0;break}return!1}},{key:"_getLandPosition",value:function(){for(var e=new Array(this._blockWidth).fill(-1),t=0;t<this._blockWidth;t++)for(var i=this._blockHeight-1;i>=0;i--)if(this._block[i][t]&0!==E){e[t]=i;break}for(var n=this._height,o=0;o<this._blockWidth;o++)if(e[o]>=0)for(var s=this._blockPosition.y;s<this._height;s++){var r=this._bmp.getAlpha(new v.Point(this._blockPosition.x+o,s+e[o]+1));if(r>0){s<n&&(n=s);break}}return new v.Point(this._blockPosition.x,n)}},{key:"_updateGhostPosition",value:function(){this._ghostPosition=this._getLandPosition()}},{key:"_addNextBlockTypeSequence",value:function(){this._nextBlockTypes=this._nextBlockTypes.concat(c(B.slice()))}},{key:"_shiftNextBlockType",value:function(){var e=this._nextBlockTypes.shift();return this._nextBlockTypes.length<=B.length&&this._addNextBlockTypeSequence(),this._redrawNextBlocks(),e}},{key:"_setCurrentBlock",value:function(e){if(this._block=h(M[e]),this._blockType=e,this._blockWidth=this._block[0].length,this._blockHeight=this._block.length,this._blockRotationDegree=0,this._gameMode===D.AUTO){var t=u(this._block);this._blockPosition=new v.Point(g+Math.floor(Math.random()*(this._fieldWidth-t.width)),g+k+R[e])}else this._blockPosition=new v.Point(g+Math.floor((this._fieldWidth-this._blockWidth)/2),g+k+R[e])}},{key:"_spawNewBlock",value:function(){null===this._block&&(this._setCurrentBlock(this._shiftNextBlockType()),this._holdable=!0,this._lastMovement=W.SPAWN,this._blockHitTest()?this.quit():(this._willLand()?this._clock.frequency=a(this._gameMode,this._level):this._clock.frequency=l(this._gameMode,this._level),this._updateGhostPosition(),this._drawBlockGhost()))}},{key:"_hold",value:function(){if(this._holdable){if(this._eraseBlockGhost(),void 0===this._holdedBlockType)this._holdedBlockType=this._blockType,this._setCurrentBlock(this._shiftNextBlockType());else{var e=this._holdedBlockType;this._holdedBlockType=this._blockType,this._setCurrentBlock(e)}this._redrawHoldedBlock(),this._holdable=!1,this._lastMovement=W.SPAWN,this._blockHitTest()?this.quit():(this._willLand()?this._clock.frequency=a(this._gameMode,this._level):this._clock.frequency=l(this._gameMode,this._level),this._updateGhostPosition(),this._drawBlockGhost())}}},{key:"_moveBlock",value:function(e){this._eraseBlockGhost();var t=this._willLand(),i=this._blockPosition;this._blockPosition=v.Point.add(this._blockPosition,e),this._blockHitTest()?(this._blockPosition=i,this._drawBlockGhost()):(this._lastMovement=W.MOVE,this._willLand()?this._clock.frequency=a(this._gameMode,this._level):t&&(this._clock.frequency=l(this._gameMode,this._level)),0!==e.x&&this._updateGhostPosition(),this._drawBlockGhost())}},{key:"_rotateBlock",value:function(e){this._eraseBlockGhost();var t=this._willLand(),i=this._block,n=this._blockPosition;this._block=_(this._block,e);var o=!1;if(this._blockHitTest()){var s=I[this._blockType][this._blockRotationDegree][e],r=!0,h=!1,c=void 0;try{for(var u,d=s[Symbol.iterator]();!(r=(u=d.next()).done);r=!0){var f=u.value;if(this._blockPosition=v.Point.add(n,f),!this._blockHitTest()){o=!0;break}}}catch(p){h=!0,c=p}finally{try{!r&&d["return"]&&d["return"]()}finally{if(h)throw c}}}else o=!0;if(o){var y=e===A.CLOCKWISE?1:-1;this._blockRotationDegree=(this._blockRotationDegree+y+4)%4,this._lastMovement=W.ROTATE,this._willLand()?this._clock.frequency=a(this._gameMode,this._level):t&&(this._clock.frequency=l(this._gameMode,this._level)),this._updateGhostPosition(),this._drawBlockGhost()}else this._block=i,this._blockPosition=n,this._drawBlockGhost()}},{key:"_clockDrop",value:function(){if(this._eraseBlockGhost(),this._willLand())this._landBlock();else{var e=this._blockPosition;this._blockPosition=v.Point.add(this._blockPosition,j.DOWN),this._blockHitTest()?(this._blockPosition=e,this._landBlock()):(this._willLand()?this._clock.frequency=a(this._gameMode,this._level):this._clock.frequency=l(this._gameMode,this._level),this._lastMovement=W.MOVE,this._drawBlockGhost())}}},{key:"_hardDrop",value:function(){this._eraseBlockGhost();var e=this._blockPosition;this._blockPosition=this._getLandPosition(),v.Point.equal(e,this._blockPosition)||(this._lastMovement=W.MOVE),this._landBlock()}},{key:"_landBlock",value:function(){this._eraseBlockGhost(),this._drawBlock(this._blockPosition,this._colors[O.BLOCK+this._blockType]);for(var e=0;e<this._blockWidth;e++)for(var t=0;t<this._blockHeight;t++)this._block[t][e]&0!==E&&this._lineCounter[this._blockPosition.y-g+t]++;this._deleteLines(),this._checkForbiddenLines()&&(this._block=null,this._spawNewBlock())}},{key:"_deleteLines",value:function(){for(var e=this._blockSpinTest(),t=this._blockSpinMiniTest(),i=0,n=0;n<this._fieldHeight;n++)if(this._lineCounter[n]>0){i=n;break}for(var o=0,s=i;s<this._fieldHeight;s++)this._lineCounter[s]===this._fieldWidth&&(this._bmp.copyPixels(this._bmp,new v.Rectangle(g,g+i,this._fieldWidth,s-i),new v.Point(g,g+i+1)),this._bmp.fillRect(new v.Rectangle(g,g+i,this._fieldWidth,1),T),this._lineCounter.splice(s,1),this._lineCounter.unshift(0),o++);if(o>0){var r=o*o*this._fieldWidth*10;this._backToBack&&(r*=1.1);var l=this._backToBack?"Back-To-Back ":"";switch(o){case 1:e?(t?(r*=1.5,this.emit("message",l+this._blockType+"-Spin Mini")):(r*=2,this.emit("message",l+this._blockType+"-Spin Single")),this._backToBack=!0):(this.emit("message",""),this._backToBack=!1);break;case 2:e?(r*=2,this.emit("message",l+this._blockType+"-Spin Double"),this._backToBack=!0):(this.emit("message","Double"),this._backToBack=!1);break;case 3:e?(r*=2,this.emit("message",l+this._blockType+"-Spin Triple"),this._backToBack=!0):(this.emit("message","Triple"),this._backToBack=!1);break;case 4:this.emit("message",l+"Quadruple"),this._backToBack=!0}for(var a=!0,h=0;h<this._fieldHeight;h++)if(this._lineCounter[h]>0){a=!1;break}a&&(r+=this._fieldWidth*this._fieldWidth*100,this.emit("message","Perfect Clear")),this._lines+=o,this._score+=Math.floor(r),this._level=Math.min(Math.floor(this._lines/20),K),this.emit("scoreUpdate",{lines:this._lines,score:this._score,level:this._level})}}},{key:"_checkForbiddenLines",value:function(){for(var e=0;e<b;e++)if(this._lineCounter[e]>0)return this.quit(),!1;return!0}},{key:"start",value:function(){this._over||(this._paused=!1,this._clock.start())}},{key:"pause",value:function(){this._over||(this._paused?(this._paused=!1,this._clock.start()):(this._paused=!0,this._clock.stop()))}},{key:"quit",value:function(){this._over=!0,this._clock.stop(),this.emit("over")}},{key:"moveLeft",value:function(){this._over||this._paused||this._gameMode===D.AUTO||this._moveBlock(j.LEFT)}},{key:"moveRight",value:function(){this._over||this._paused||this._gameMode===D.AUTO||this._moveBlock(j.RIGHT)}},{key:"softDrop",value:function(){this._over||this._paused||this._gameMode===D.AUTO||this._moveBlock(j.DOWN)}},{key:"hardDrop",value:function(){this._over||this._paused||this._gameMode===D.AUTO||this._hardDrop()}},{key:"rotateClockwise",value:function(){this._over||this._paused||this._gameMode===D.AUTO||this._rotateBlock(A.CLOCKWISE)}},{key:"rotateCounterclockwise",value:function(){this._over||this._paused||this._gameMode===D.AUTO||this._rotateBlock(A.COUNTERCLOCKWISE)}},{key:"hold",value:function(){this._over||this._paused||this._gameMode===D.AUTO||this._hold()}},{key:"innerWidth",get:function(){return this._innerWidth}},{key:"innerHeight",get:function(){return this._innerHeight}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"topOffset",get:function(){return g+k}},{key:"bottomOffset",get:function(){return g}},{key:"leftOffset",get:function(){return g}},{key:"rightOffset",get:function(){return g}},{key:"canvas",get:function(){return this._canvas}},{key:"nextCanvas",get:function(){return this._nextCanvas}},{key:"holdCanvas",get:function(){return this._holdCanvas}},{key:"gameMode",get:function(){return this._gameMode}},{key:"paused",get:function(){return this._paused}},{key:"over",get:function(){return this._over}},{key:"lines",get:function(){return this._lines}},{key:"score",get:function(){return this._score}},{key:"level",get:function(){return this._level}}]),t}(y.EventEmitter2)},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t,i){return e<t?t:e>i?i:e}Object.defineProperty(t,"__esModule",{value:!0}),t.TitleManager=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=i(1),c=i(9),_=n(c),u=i(3),d=10,f=20;t.TitleManager=function(e){function t(){o(this,t);var e=s(this,Object.getPrototypeOf(t).call(this));return e._titleScreen=window.document.getElementById("title-screen"),e._configForm=window.document.getElementById("title-config-form"),e._maximizeButton=window.document.getElementById("title-maximize-button"),e._playButton=window.document.getElementById("title-play-button"),e._fullscreenButton=window.document.getElementById("title-fullscreen-button"),e._howToPlayButton=window.document.getElementById("title-how-to-play-button"),e._versionText=window.document.getElementById("title-version-text"),e._howToPlayScreen=window.document.getElementById("how-to-play-screen"),e._howToPlayOKButton=window.document.getElementById("how-to-play-ok-button"),e._versionText.innerText="v"+_["default"].version,e._visible=!1,e._visibleHowToPlay=!1,e._updateVisibility(),e._updateGameSizeConfig(!0),e._enabled=!1,window.addEventListener("resize",function(){e._updateGameSizeConfig(!1)}),e._configForm.addEventListener("change",function(){e._updateGameSizeConfig(!1)}),e._maximizeButton.addEventListener("click",function(){e._enabled&&(e._configForm.width.value=""+e._gameMaxWidth,e._configForm.height.value=""+e._gameMaxHeight)}),e._playButton.addEventListener("click",function(){e._enabled&&e._playGame()}),e._fullscreenButton.addEventListener("click",function(){e._enabled&&(0,u.toggleFullscreen)()}),e._howToPlayButton.addEventListener("click",function(){e._enabled&&(e._visibleHowToPlay=!e._visibleHowToPlay,e._updateVisibility())}),e._howToPlayOKButton.addEventListener("click",function(){e._enabled&&(e._visibleHowToPlay=!1,e._updateVisibility())}),e}return r(t,e),a(t,[{key:"_updateVisibility",value:function(){this._visible?(this._titleScreen.style.display="block",this._visibleHowToPlay?this._howToPlayScreen.style.display="block":this._howToPlayScreen.style.display="none"):(this._titleScreen.style.display="none",this._howToPlayScreen.style.display="none")}},{key:"_updateGameSizeConfig",value:function(e){e&&(this._gameMinWidth=d,this._gameMinHeight=f,this._configForm.width.min=""+this._gameMinWidth,this._configForm.width.value=""+this._gameMinWidth,this._configForm.height.min=""+this._gameMinHeight,this._configForm.height.value=""+this._gameMinHeight);var t=this._configForm["high-resolution"].checked?window.devicePixelRatio:1;this._gameMaxWidth=Math.floor(window.innerWidth*t),this._gameMaxHeight=Math.floor(window.innerHeight*t),this._configForm.width.max=""+this._gameMaxWidth,this._configForm.height.max=""+this._gameMaxHeight}},{key:"_playGame",value:function(){var e=l(parseInt(this._configForm.width.value)||0,this._gameMinWidth,this._gameMaxWidth),t=l(parseInt(this._configForm.height.value)||0,this._gameMinHeight,this._gameMaxHeight);this._configForm.width.value=e.toString(),this._configForm.height.value=t.toString();var i={width:e,height:t,gameMode:this._configForm["game-mode"].value,scaling:this._configForm.scaling.checked,highResolution:this._configForm["high-resolution"].checked,colorScheme:this._configForm["color-scheme"].value};this.emit("play",i)}},{key:"show",value:function(){this._visible=!0,this._updateVisibility(),this._enabled=!0}},{key:"hide",value:function(){this._visible=!1,this._visibleHowToPlay=!1,this._updateVisibility(),this._enabled=!1}}]),t}(h.EventEmitter2)},function(e,t){e.exports={name:"@susisu/dotris-canvas",version:"1.1.0",description:"","private":!0,main:"index.js",scripts:{test:'echo "Error: no test specified" && exit 1',build:"npm run build:release","build:debug":"NODE_ENV=development webpack -d","build:release":"NODE_ENV=production webpack",start:"NODE_ENV=development node app.js"},repository:{type:"git",url:"git+https://github.com/susisu/dotris-canvas.git"},author:"Susisu <susisu2413@yahoo.co.jp> (https://github.com/susisu)",license:"MIT",bugs:{url:"https://github.com/susisu/dotris-canvas/issues"},homepage:"https://github.com/susisu/dotris-canvas#readme",devDependencies:{"babel-core":"^6.10.4","babel-loader":"^6.2.4","babel-preset-es2015":"^6.9.0","browser-sync":"^2.13.0","bs-fullscreen-message":"^1.1.0",eventemitter2:"^2.0.0","json-loader":"^0.5.4","strip-ansi":"^3.0.1",webpack:"^1.13.1","webpack-dev-middleware":"^1.6.1"}}}]);